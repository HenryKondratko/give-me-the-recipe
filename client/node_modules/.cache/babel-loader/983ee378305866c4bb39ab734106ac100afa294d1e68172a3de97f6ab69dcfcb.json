{"ast":null,"code":"/**\n * Copyright 2019 Google Inc. All rights reserved.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar _IsolatedWorld_instances, _IsolatedWorld_frame, _IsolatedWorld_document, _IsolatedWorld_context, _IsolatedWorld_detached, _IsolatedWorld_contextBindings, _IsolatedWorld_bindings, _IsolatedWorld_taskManager, _IsolatedWorld_client_get, _IsolatedWorld_frameManager_get, _IsolatedWorld_timeoutSettings_get, _IsolatedWorld_mutex, _IsolatedWorld_onBindingCalled, _Mutex_locked, _Mutex_acquirers;\nimport { assert } from '../util/assert.js';\nimport { createDeferredPromise } from '../util/DeferredPromise.js';\nimport { MAIN_WORLD, PUPPETEER_WORLD } from './IsolatedWorlds.js';\nimport { LifecycleWatcher } from './LifecycleWatcher.js';\nimport { addPageBinding, createJSHandle, debugError, setPageContent } from './util.js';\nimport { TaskManager, WaitTask } from './WaitTask.js';\n/**\n * @internal\n */\nexport class IsolatedWorld {\n  get taskManager() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_taskManager, \"f\");\n  }\n  get _bindings() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_bindings, \"f\");\n  }\n  constructor(frame) {\n    _IsolatedWorld_instances.add(this);\n    _IsolatedWorld_frame.set(this, void 0);\n    _IsolatedWorld_document.set(this, void 0);\n    _IsolatedWorld_context.set(this, createDeferredPromise());\n    _IsolatedWorld_detached.set(this, false);\n    // Set of bindings that have been registered in the current context.\n    _IsolatedWorld_contextBindings.set(this, new Set());\n    // Contains mapping from functions that should be bound to Puppeteer functions.\n    _IsolatedWorld_bindings.set(this, new Map());\n    _IsolatedWorld_taskManager.set(this, new TaskManager());\n    // If multiple waitFor are set up asynchronously, we need to wait for the\n    // first one to set up the binding in the page before running the others.\n    _IsolatedWorld_mutex.set(this, new Mutex());\n    _IsolatedWorld_onBindingCalled.set(this, async event => {\n      let payload;\n      try {\n        payload = JSON.parse(event.payload);\n      } catch {\n        // The binding was either called by something in the page or it was\n        // called before our wrapper was initialized.\n        return;\n      }\n      const {\n        type,\n        name,\n        seq,\n        args,\n        isTrivial\n      } = payload;\n      if (type !== 'internal') {\n        return;\n      }\n      if (!__classPrivateFieldGet(this, _IsolatedWorld_contextBindings, \"f\").has(name)) {\n        return;\n      }\n      const context = await __classPrivateFieldGet(this, _IsolatedWorld_context, \"f\");\n      if (event.executionContextId !== context._contextId) {\n        return;\n      }\n      const binding = this._bindings.get(name);\n      await (binding === null || binding === void 0 ? void 0 : binding.run(context, seq, args, isTrivial));\n    });\n    // Keep own reference to client because it might differ from the FrameManager's\n    // client for OOP iframes.\n    __classPrivateFieldSet(this, _IsolatedWorld_frame, frame, \"f\");\n    __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).on('Runtime.bindingCalled', __classPrivateFieldGet(this, _IsolatedWorld_onBindingCalled, \"f\"));\n  }\n  frame() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\");\n  }\n  clearContext() {\n    __classPrivateFieldSet(this, _IsolatedWorld_document, undefined, \"f\");\n    __classPrivateFieldSet(this, _IsolatedWorld_context, createDeferredPromise(), \"f\");\n  }\n  setContext(context) {\n    __classPrivateFieldGet(this, _IsolatedWorld_contextBindings, \"f\").clear();\n    __classPrivateFieldGet(this, _IsolatedWorld_context, \"f\").resolve(context);\n    __classPrivateFieldGet(this, _IsolatedWorld_taskManager, \"f\").rerunAll();\n  }\n  hasContext() {\n    return __classPrivateFieldGet(this, _IsolatedWorld_context, \"f\").resolved();\n  }\n  _detach() {\n    __classPrivateFieldSet(this, _IsolatedWorld_detached, true, \"f\");\n    __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).off('Runtime.bindingCalled', __classPrivateFieldGet(this, _IsolatedWorld_onBindingCalled, \"f\"));\n    __classPrivateFieldGet(this, _IsolatedWorld_taskManager, \"f\").terminateAll(new Error('waitForFunction failed: frame got detached.'));\n  }\n  executionContext() {\n    if (__classPrivateFieldGet(this, _IsolatedWorld_detached, \"f\")) {\n      throw new Error(`Execution context is not available in detached frame \"${__classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\").url()}\" (are you trying to evaluate?)`);\n    }\n    if (__classPrivateFieldGet(this, _IsolatedWorld_context, \"f\") === null) {\n      throw new Error(`Execution content promise is missing`);\n    }\n    return __classPrivateFieldGet(this, _IsolatedWorld_context, \"f\");\n  }\n  async evaluateHandle(pageFunction) {\n    const context = await this.executionContext();\n    for (var _len = arguments.length, args = new Array(_len > 1 ? _len - 1 : 0), _key = 1; _key < _len; _key++) {\n      args[_key - 1] = arguments[_key];\n    }\n    return context.evaluateHandle(pageFunction, ...args);\n  }\n  async evaluate(pageFunction) {\n    const context = await this.executionContext();\n    for (var _len2 = arguments.length, args = new Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      args[_key2 - 1] = arguments[_key2];\n    }\n    return context.evaluate(pageFunction, ...args);\n  }\n  async $(selector) {\n    const document = await this.document();\n    return document.$(selector);\n  }\n  async $$(selector) {\n    const document = await this.document();\n    return document.$$(selector);\n  }\n  async document() {\n    if (__classPrivateFieldGet(this, _IsolatedWorld_document, \"f\")) {\n      return __classPrivateFieldGet(this, _IsolatedWorld_document, \"f\");\n    }\n    const context = await this.executionContext();\n    __classPrivateFieldSet(this, _IsolatedWorld_document, await context.evaluateHandle(() => {\n      return document;\n    }), \"f\");\n    return __classPrivateFieldGet(this, _IsolatedWorld_document, \"f\");\n  }\n  async $x(expression) {\n    const document = await this.document();\n    return document.$x(expression);\n  }\n  async $eval(selector, pageFunction) {\n    const document = await this.document();\n    for (var _len3 = arguments.length, args = new Array(_len3 > 2 ? _len3 - 2 : 0), _key3 = 2; _key3 < _len3; _key3++) {\n      args[_key3 - 2] = arguments[_key3];\n    }\n    return document.$eval(selector, pageFunction, ...args);\n  }\n  async $$eval(selector, pageFunction) {\n    const document = await this.document();\n    for (var _len4 = arguments.length, args = new Array(_len4 > 2 ? _len4 - 2 : 0), _key4 = 2; _key4 < _len4; _key4++) {\n      args[_key4 - 2] = arguments[_key4];\n    }\n    return document.$$eval(selector, pageFunction, ...args);\n  }\n  async content() {\n    return await this.evaluate(() => {\n      let retVal = '';\n      if (document.doctype) {\n        retVal = new XMLSerializer().serializeToString(document.doctype);\n      }\n      if (document.documentElement) {\n        retVal += document.documentElement.outerHTML;\n      }\n      return retVal;\n    });\n  }\n  async setContent(html) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const {\n      waitUntil = ['load'],\n      timeout = __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_timeoutSettings_get).navigationTimeout()\n    } = options;\n    await setPageContent(this, html);\n    const watcher = new LifecycleWatcher(__classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_frameManager_get), __classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\"), waitUntil, timeout);\n    const error = await Promise.race([watcher.timeoutOrTerminationPromise(), watcher.lifecyclePromise()]);\n    watcher.dispose();\n    if (error) {\n      throw error;\n    }\n  }\n  async click(selector, options) {\n    const handle = await this.$(selector);\n    assert(handle, `No element found for selector: ${selector}`);\n    await handle.click(options);\n    await handle.dispose();\n  }\n  async focus(selector) {\n    const handle = await this.$(selector);\n    assert(handle, `No element found for selector: ${selector}`);\n    await handle.focus();\n    await handle.dispose();\n  }\n  async hover(selector) {\n    const handle = await this.$(selector);\n    assert(handle, `No element found for selector: ${selector}`);\n    await handle.hover();\n    await handle.dispose();\n  }\n  async select(selector) {\n    const handle = await this.$(selector);\n    assert(handle, `No element found for selector: ${selector}`);\n    for (var _len5 = arguments.length, values = new Array(_len5 > 1 ? _len5 - 1 : 0), _key5 = 1; _key5 < _len5; _key5++) {\n      values[_key5 - 1] = arguments[_key5];\n    }\n    const result = await handle.select(...values);\n    await handle.dispose();\n    return result;\n  }\n  async tap(selector) {\n    const handle = await this.$(selector);\n    assert(handle, `No element found for selector: ${selector}`);\n    await handle.tap();\n    await handle.dispose();\n  }\n  async type(selector, text, options) {\n    const handle = await this.$(selector);\n    assert(handle, `No element found for selector: ${selector}`);\n    await handle.type(text, options);\n    await handle.dispose();\n  }\n  async _addBindingToContext(context, name) {\n    if (__classPrivateFieldGet(this, _IsolatedWorld_contextBindings, \"f\").has(name)) {\n      return;\n    }\n    await __classPrivateFieldGet(this, _IsolatedWorld_mutex, \"f\").acquire();\n    try {\n      await context._client.send('Runtime.addBinding', {\n        name,\n        executionContextName: context._contextName\n      });\n      await context.evaluate(addPageBinding, 'internal', name);\n      __classPrivateFieldGet(this, _IsolatedWorld_contextBindings, \"f\").add(name);\n    } catch (error) {\n      // We could have tried to evaluate in a context which was already\n      // destroyed. This happens, for example, if the page is navigated while\n      // we are trying to add the binding\n      if (error instanceof Error) {\n        // Destroyed context.\n        if (error.message.includes('Execution context was destroyed')) {\n          return;\n        }\n        // Missing context.\n        if (error.message.includes('Cannot find context with specified id')) {\n          return;\n        }\n      }\n      debugError(error);\n    } finally {\n      __classPrivateFieldGet(this, _IsolatedWorld_mutex, \"f\").release();\n    }\n  }\n  waitForFunction(pageFunction) {\n    let options = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : {};\n    const {\n      polling = 'raf',\n      timeout = __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_timeoutSettings_get).timeout(),\n      root\n    } = options;\n    if (typeof polling === 'number' && polling < 0) {\n      throw new Error('Cannot poll with non-positive interval');\n    }\n    for (var _len6 = arguments.length, args = new Array(_len6 > 2 ? _len6 - 2 : 0), _key6 = 2; _key6 < _len6; _key6++) {\n      args[_key6 - 2] = arguments[_key6];\n    }\n    const waitTask = new WaitTask(this, {\n      polling,\n      root,\n      timeout\n    }, pageFunction, ...args);\n    return waitTask.result;\n  }\n  async title() {\n    return this.evaluate(() => {\n      return document.title;\n    });\n  }\n  async adoptBackendNode(backendNodeId) {\n    const executionContext = await this.executionContext();\n    const {\n      object\n    } = await __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).send('DOM.resolveNode', {\n      backendNodeId: backendNodeId,\n      executionContextId: executionContext._contextId\n    });\n    return createJSHandle(executionContext, object);\n  }\n  async adoptHandle(handle) {\n    const context = await this.executionContext();\n    assert(handle.executionContext() !== context, 'Cannot adopt handle that already belongs to this execution context');\n    const nodeInfo = await __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).send('DOM.describeNode', {\n      objectId: handle.id\n    });\n    return await this.adoptBackendNode(nodeInfo.node.backendNodeId);\n  }\n  async transferHandle(handle) {\n    const context = await this.executionContext();\n    if (handle.executionContext() === context) {\n      return handle;\n    }\n    const info = await __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_client_get).send('DOM.describeNode', {\n      objectId: handle.remoteObject().objectId\n    });\n    const newHandle = await this.adoptBackendNode(info.node.backendNodeId);\n    await handle.dispose();\n    return newHandle;\n  }\n}\n_IsolatedWorld_frame = new WeakMap(), _IsolatedWorld_document = new WeakMap(), _IsolatedWorld_context = new WeakMap(), _IsolatedWorld_detached = new WeakMap(), _IsolatedWorld_contextBindings = new WeakMap(), _IsolatedWorld_bindings = new WeakMap(), _IsolatedWorld_taskManager = new WeakMap(), _IsolatedWorld_mutex = new WeakMap(), _IsolatedWorld_onBindingCalled = new WeakMap(), _IsolatedWorld_instances = new WeakSet(), _IsolatedWorld_client_get = function _IsolatedWorld_client_get() {\n  return __classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\")._client();\n}, _IsolatedWorld_frameManager_get = function _IsolatedWorld_frameManager_get() {\n  return __classPrivateFieldGet(this, _IsolatedWorld_frame, \"f\")._frameManager;\n}, _IsolatedWorld_timeoutSettings_get = function _IsolatedWorld_timeoutSettings_get() {\n  return __classPrivateFieldGet(this, _IsolatedWorld_instances, \"a\", _IsolatedWorld_frameManager_get).timeoutSettings;\n};\nclass Mutex {\n  constructor() {\n    _Mutex_locked.set(this, false);\n    _Mutex_acquirers.set(this, []);\n  }\n  // This is FIFO.\n  acquire() {\n    if (!__classPrivateFieldGet(this, _Mutex_locked, \"f\")) {\n      __classPrivateFieldSet(this, _Mutex_locked, true, \"f\");\n      return Promise.resolve();\n    }\n    let resolve;\n    const promise = new Promise(res => {\n      resolve = res;\n    });\n    __classPrivateFieldGet(this, _Mutex_acquirers, \"f\").push(resolve);\n    return promise;\n  }\n  release() {\n    const resolve = __classPrivateFieldGet(this, _Mutex_acquirers, \"f\").shift();\n    if (!resolve) {\n      __classPrivateFieldSet(this, _Mutex_locked, false, \"f\");\n      return;\n    }\n    resolve();\n  }\n}\n_Mutex_locked = new WeakMap(), _Mutex_acquirers = new WeakMap();","map":{"version":3,"names":["assert","createDeferredPromise","MAIN_WORLD","PUPPETEER_WORLD","LifecycleWatcher","addPageBinding","createJSHandle","debugError","setPageContent","TaskManager","WaitTask","IsolatedWorld","taskManager","__classPrivateFieldGet","_IsolatedWorld_taskManager","_bindings","_IsolatedWorld_bindings","constructor","frame","_IsolatedWorld_frame","set","_IsolatedWorld_document","_IsolatedWorld_context","_IsolatedWorld_detached","_IsolatedWorld_contextBindings","Set","Map","_IsolatedWorld_mutex","Mutex","_IsolatedWorld_onBindingCalled","event","payload","JSON","parse","type","name","seq","args","isTrivial","has","context","executionContextId","_contextId","binding","get","run","__classPrivateFieldSet","_IsolatedWorld_instances","_IsolatedWorld_client_get","on","clearContext","undefined","setContext","clear","resolve","rerunAll","hasContext","resolved","_detach","off","terminateAll","Error","executionContext","url","evaluateHandle","pageFunction","_len","arguments","length","Array","_key","evaluate","_len2","_key2","$","selector","document","$$","$x","expression","$eval","_len3","_key3","$$eval","_len4","_key4","content","retVal","doctype","XMLSerializer","serializeToString","documentElement","outerHTML","setContent","html","options","waitUntil","timeout","_IsolatedWorld_timeoutSettings_get","navigationTimeout","watcher","_IsolatedWorld_frameManager_get","error","Promise","race","timeoutOrTerminationPromise","lifecyclePromise","dispose","click","handle","focus","hover","select","_len5","values","_key5","result","tap","text","_addBindingToContext","acquire","_client","send","executionContextName","_contextName","add","message","includes","release","waitForFunction","polling","root","_len6","_key6","waitTask","title","adoptBackendNode","backendNodeId","object","adoptHandle","nodeInfo","objectId","id","node","transferHandle","info","remoteObject","newHandle","_frameManager","timeoutSettings","_Mutex_locked","_Mutex_acquirers","promise","res","push","shift"],"sources":["../../../../src/common/IsolatedWorld.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}