{"ast":null,"code":"var __classPrivateFieldSet = this && this.__classPrivateFieldSet || function (receiver, state, value, kind, f) {\n  if (kind === \"m\") throw new TypeError(\"Private method is not writable\");\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a setter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot write private member to an object whose class did not declare it\");\n  return kind === \"a\" ? f.call(receiver, value) : f ? f.value = value : state.set(receiver, value), value;\n};\nvar __classPrivateFieldGet = this && this.__classPrivateFieldGet || function (receiver, state, kind, f) {\n  if (kind === \"a\" && !f) throw new TypeError(\"Private accessor was defined without a getter\");\n  if (typeof state === \"function\" ? receiver !== state || !f : !state.has(receiver)) throw new TypeError(\"Cannot read private member from an object whose class did not declare it\");\n  return kind === \"m\" ? f : kind === \"a\" ? f.call(receiver) : f ? f.value : state.get(receiver);\n};\nvar _HTTPResponse_instances, _HTTPResponse_client, _HTTPResponse_request, _HTTPResponse_contentPromise, _HTTPResponse_bodyLoadedPromise, _HTTPResponse_bodyLoadedPromiseFulfill, _HTTPResponse_remoteAddress, _HTTPResponse_status, _HTTPResponse_statusText, _HTTPResponse_url, _HTTPResponse_fromDiskCache, _HTTPResponse_fromServiceWorker, _HTTPResponse_headers, _HTTPResponse_securityDetails, _HTTPResponse_timing, _HTTPResponse_parseStatusTextFromExtrInfo;\nimport { HTTPResponse as BaseHTTPResponse } from '../api/HTTPResponse.js';\nimport { ProtocolError } from './Errors.js';\nimport { SecurityDetails } from './SecurityDetails.js';\n/**\n * @internal\n */\nexport class HTTPResponse extends BaseHTTPResponse {\n  constructor(client, request, responsePayload, extraInfo) {\n    super();\n    _HTTPResponse_instances.add(this);\n    _HTTPResponse_client.set(this, void 0);\n    _HTTPResponse_request.set(this, void 0);\n    _HTTPResponse_contentPromise.set(this, null);\n    _HTTPResponse_bodyLoadedPromise.set(this, void 0);\n    _HTTPResponse_bodyLoadedPromiseFulfill.set(this, () => {});\n    _HTTPResponse_remoteAddress.set(this, void 0);\n    _HTTPResponse_status.set(this, void 0);\n    _HTTPResponse_statusText.set(this, void 0);\n    _HTTPResponse_url.set(this, void 0);\n    _HTTPResponse_fromDiskCache.set(this, void 0);\n    _HTTPResponse_fromServiceWorker.set(this, void 0);\n    _HTTPResponse_headers.set(this, {});\n    _HTTPResponse_securityDetails.set(this, void 0);\n    _HTTPResponse_timing.set(this, void 0);\n    __classPrivateFieldSet(this, _HTTPResponse_client, client, \"f\");\n    __classPrivateFieldSet(this, _HTTPResponse_request, request, \"f\");\n    __classPrivateFieldSet(this, _HTTPResponse_bodyLoadedPromise, new Promise(fulfill => {\n      __classPrivateFieldSet(this, _HTTPResponse_bodyLoadedPromiseFulfill, fulfill, \"f\");\n    }), \"f\");\n    __classPrivateFieldSet(this, _HTTPResponse_remoteAddress, {\n      ip: responsePayload.remoteIPAddress,\n      port: responsePayload.remotePort\n    }, \"f\");\n    __classPrivateFieldSet(this, _HTTPResponse_statusText, __classPrivateFieldGet(this, _HTTPResponse_instances, \"m\", _HTTPResponse_parseStatusTextFromExtrInfo).call(this, extraInfo) || responsePayload.statusText, \"f\");\n    __classPrivateFieldSet(this, _HTTPResponse_url, request.url(), \"f\");\n    __classPrivateFieldSet(this, _HTTPResponse_fromDiskCache, !!responsePayload.fromDiskCache, \"f\");\n    __classPrivateFieldSet(this, _HTTPResponse_fromServiceWorker, !!responsePayload.fromServiceWorker, \"f\");\n    __classPrivateFieldSet(this, _HTTPResponse_status, extraInfo ? extraInfo.statusCode : responsePayload.status, \"f\");\n    const headers = extraInfo ? extraInfo.headers : responsePayload.headers;\n    for (const [key, value] of Object.entries(headers)) {\n      __classPrivateFieldGet(this, _HTTPResponse_headers, \"f\")[key.toLowerCase()] = value;\n    }\n    __classPrivateFieldSet(this, _HTTPResponse_securityDetails, responsePayload.securityDetails ? new SecurityDetails(responsePayload.securityDetails) : null, \"f\");\n    __classPrivateFieldSet(this, _HTTPResponse_timing, responsePayload.timing || null, \"f\");\n  }\n  _resolveBody(err) {\n    if (err) {\n      return __classPrivateFieldGet(this, _HTTPResponse_bodyLoadedPromiseFulfill, \"f\").call(this, err);\n    }\n    return __classPrivateFieldGet(this, _HTTPResponse_bodyLoadedPromiseFulfill, \"f\").call(this);\n  }\n  remoteAddress() {\n    return __classPrivateFieldGet(this, _HTTPResponse_remoteAddress, \"f\");\n  }\n  url() {\n    return __classPrivateFieldGet(this, _HTTPResponse_url, \"f\");\n  }\n  ok() {\n    // TODO: document === 0 case?\n    return __classPrivateFieldGet(this, _HTTPResponse_status, \"f\") === 0 || __classPrivateFieldGet(this, _HTTPResponse_status, \"f\") >= 200 && __classPrivateFieldGet(this, _HTTPResponse_status, \"f\") <= 299;\n  }\n  status() {\n    return __classPrivateFieldGet(this, _HTTPResponse_status, \"f\");\n  }\n  statusText() {\n    return __classPrivateFieldGet(this, _HTTPResponse_statusText, \"f\");\n  }\n  headers() {\n    return __classPrivateFieldGet(this, _HTTPResponse_headers, \"f\");\n  }\n  securityDetails() {\n    return __classPrivateFieldGet(this, _HTTPResponse_securityDetails, \"f\");\n  }\n  timing() {\n    return __classPrivateFieldGet(this, _HTTPResponse_timing, \"f\");\n  }\n  buffer() {\n    if (!__classPrivateFieldGet(this, _HTTPResponse_contentPromise, \"f\")) {\n      __classPrivateFieldSet(this, _HTTPResponse_contentPromise, __classPrivateFieldGet(this, _HTTPResponse_bodyLoadedPromise, \"f\").then(async error => {\n        if (error) {\n          throw error;\n        }\n        try {\n          const response = await __classPrivateFieldGet(this, _HTTPResponse_client, \"f\").send('Network.getResponseBody', {\n            requestId: __classPrivateFieldGet(this, _HTTPResponse_request, \"f\")._requestId\n          });\n          return Buffer.from(response.body, response.base64Encoded ? 'base64' : 'utf8');\n        } catch (error) {\n          if (error instanceof ProtocolError && error.originalMessage === 'No resource with given identifier found') {\n            throw new ProtocolError('Could not load body for this request. This might happen if the request is a preflight request.');\n          }\n          throw error;\n        }\n      }), \"f\");\n    }\n    return __classPrivateFieldGet(this, _HTTPResponse_contentPromise, \"f\");\n  }\n  request() {\n    return __classPrivateFieldGet(this, _HTTPResponse_request, \"f\");\n  }\n  fromCache() {\n    return __classPrivateFieldGet(this, _HTTPResponse_fromDiskCache, \"f\") || __classPrivateFieldGet(this, _HTTPResponse_request, \"f\")._fromMemoryCache;\n  }\n  fromServiceWorker() {\n    return __classPrivateFieldGet(this, _HTTPResponse_fromServiceWorker, \"f\");\n  }\n  frame() {\n    return __classPrivateFieldGet(this, _HTTPResponse_request, \"f\").frame();\n  }\n}\n_HTTPResponse_client = new WeakMap(), _HTTPResponse_request = new WeakMap(), _HTTPResponse_contentPromise = new WeakMap(), _HTTPResponse_bodyLoadedPromise = new WeakMap(), _HTTPResponse_bodyLoadedPromiseFulfill = new WeakMap(), _HTTPResponse_remoteAddress = new WeakMap(), _HTTPResponse_status = new WeakMap(), _HTTPResponse_statusText = new WeakMap(), _HTTPResponse_url = new WeakMap(), _HTTPResponse_fromDiskCache = new WeakMap(), _HTTPResponse_fromServiceWorker = new WeakMap(), _HTTPResponse_headers = new WeakMap(), _HTTPResponse_securityDetails = new WeakMap(), _HTTPResponse_timing = new WeakMap(), _HTTPResponse_instances = new WeakSet(), _HTTPResponse_parseStatusTextFromExtrInfo = function _HTTPResponse_parseStatusTextFromExtrInfo(extraInfo) {\n  if (!extraInfo || !extraInfo.headersText) {\n    return;\n  }\n  const firstLine = extraInfo.headersText.split('\\r', 1)[0];\n  if (!firstLine) {\n    return;\n  }\n  const match = firstLine.match(/[^ ]* [^ ]* (.*)/);\n  if (!match) {\n    return;\n  }\n  const statusText = match[1];\n  if (!statusText) {\n    return;\n  }\n  return statusText;\n};","map":{"version":3,"names":["HTTPResponse","BaseHTTPResponse","ProtocolError","SecurityDetails","constructor","client","request","responsePayload","extraInfo","_HTTPResponse_client","set","_HTTPResponse_request","_HTTPResponse_contentPromise","_HTTPResponse_bodyLoadedPromise","_HTTPResponse_bodyLoadedPromiseFulfill","_HTTPResponse_remoteAddress","_HTTPResponse_status","_HTTPResponse_statusText","_HTTPResponse_url","_HTTPResponse_fromDiskCache","_HTTPResponse_fromServiceWorker","_HTTPResponse_headers","_HTTPResponse_securityDetails","_HTTPResponse_timing","__classPrivateFieldSet","Promise","fulfill","ip","remoteIPAddress","port","remotePort","__classPrivateFieldGet","_HTTPResponse_instances","_HTTPResponse_parseStatusTextFromExtrInfo","call","statusText","url","fromDiskCache","fromServiceWorker","statusCode","status","headers","key","value","Object","entries","toLowerCase","securityDetails","timing","_resolveBody","err","remoteAddress","ok","buffer","then","error","response","send","requestId","_requestId","Buffer","from","body","base64Encoded","originalMessage","fromCache","_fromMemoryCache","frame","headersText","firstLine","split","match"],"sources":["../../../../src/common/HTTPResponse.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}